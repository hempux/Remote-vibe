services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5002:5002"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:5002
      - VscodeServerUrl=http://vscode-server:5000
      - VscodeServerAuthToken=remote-vibe-internal-token
      - Database__Path=/app/data/remotevibe.db
    volumes:
      - ./backend/logs:/app/logs
      - backend-data:/app/data
    networks:
      - remotevibe-network

  vscode-server:
    build:
      context: .
      dockerfile: ./vscode-server/Dockerfile
    ports:
      - "8080:8080"
    environment:
      - PASSWORD=remotevibe
      - REMOTE_VIBE_BACKEND_URL=http://backend:5002
      - REMOTE_VIBE_AUTO_START=true
      - REMOTE_VIBE_AUTH_TOKEN=remote-vibe-internal-token
      - REMOTE_VIBE_PORT=5000
      - REMOTE_VIBE_DB_PATH=/home/coder/data/vscode-server.db
    volumes:
      - ./workspace:/home/coder/workspace
      - vscode-data:/home/coder/.local/share/code-server
      - vscode-server-data:/home/coder/data
    networks:
      - remotevibe-network
    depends_on:
      - backend

networks:
  remotevibe-network:
    driver: bridge

volumes:
  vscode-data:
  backend-data:
  vscode-server-data:
